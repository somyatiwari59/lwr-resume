const fs = require('fs');
const path = require('path');
const resolve = require('resolve');
const rootPath = path.join(__dirname, './');

// Get the LWR Version
let version;
if (globalThis.LWR_VERSION) {
    version = globalThis.LWR_VERSION;
} else {
    version = JSON.parse(fs.readFileSync(path.join(rootPath, 'package.json'), 'utf-8')).version;
}

// Get the LWC Version
let lwcVersion;
if (globalThis.LWC_VERSION) {
    version = globalThis.LWC_VERSION;
} else {
    try {
        const packageJsonPath = resolve.sync(`lwc/package.json`);
        const { version: packageVersion } = JSON.parse(fs.readFileSync(packageJsonPath), 'utf-8');
        lwcVersion = packageVersion;
    } catch(err) {
        console.log(`[config] peer dependency lwc was not provided`);
        lwcVersion = 'not-provided';
    }
}

module.exports = {
    rootPath,
    version,
    lwcVersion
};
