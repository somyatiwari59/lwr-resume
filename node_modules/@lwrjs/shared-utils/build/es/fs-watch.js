import chokidar from 'chokidar';
import { debounce } from './object.js';
import { logger } from './logger.js';
/**
 * Factory comptable with the LWR Runtime to create a file watch library for LWR dev server.
 * When importing this module make sure the optional library 'chokidar' is installed.
 */
export class WatcherFactoryImpl {
    /**
     * Set up a watcher with the given options
     * @param options
     */
    createFileWatcher(options = { persistent: true, ignored: '**/node_modules/**' }) {
        return chokidar.watch([], options);
    }
    /**
     * Set up file watcher
     */
    setupWatcher(onModuleChange) {
        const fileWatcher = this.createFileWatcher();
        fileWatcher.on('change', debounce((file) => onModuleChange(file), 500));
        fileWatcher.on('unlink', debounce((file) => onModuleChange(file), 500));
        fileWatcher.on('add', (file) => logger.info(`Watching: ${file}`));
        return fileWatcher;
    }
}
//# sourceMappingURL=fs-watch.js.map