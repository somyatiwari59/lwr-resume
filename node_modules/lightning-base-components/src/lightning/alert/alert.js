import { api } from 'lwc';
import LightningInteractiveDialogBase from 'lightning/interactiveDialogBase';
import LightningOverlay from 'lightning/overlay';
import { parent, instanceName, secure } from 'lightning/overlayUtils';
import labelDefault from '@salesforce/label/LightningAlert.defaultLabel';

/**
 * Create an alert modal within your component that communicates
 * a state that affects the entire system, not just a feature or page.
 */

export default class LightningAlert extends LightningOverlay {
    static [instanceName] = 'lightning-alert';
    static [parent] = LightningInteractiveDialogBase;

    /**
     * value to use for header text in "header" variant
     * or aria-label in "headerless" variant
     * @type {string}
     * @default "Alert" (translated accordingly)
     */
    @api label = labelDefault;

    /**
     * text to display in body of modal
     */
    @api message = '';

    /**
     * variant to use for alert; may be
     * set to "header" or "headerless"
     */
    @api variant = 'header';

    /**
     * theme to use when variant is "header"
     * valid values are based on SLDS themes and are
     * listed in "themeOptions" of interactiveDialogBase.js
     */
    @api theme = 'default';

    /**
     * Dispatches privateclose event
     * and closes dialog
     */
    close(result) {
        const promise = new Promise((resolve) => {
            this.dispatchEvent(
                new CustomEvent('privateclose', {
                    detail: {
                        resolve,
                        [secure]: true,
                    },
                    bubbles: true,
                })
            );
        });
        super.close(result, promise);
    }

    /**
     * Dispatches privatechildrender event
     * with data parent needs to correctly render
     */
    renderedCallback() {
        const evt = new CustomEvent('privatechildrender', {
            bubbles: true,
            detail: {
                message: this.message,
                label: this.label,
                hideCancel: true,
                showDescription: true,
                role: 'alertdialog',
            },
        });
        this.dispatchEvent(evt);
    }
}
